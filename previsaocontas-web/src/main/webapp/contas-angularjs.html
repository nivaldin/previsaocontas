<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta http-equiv="Refresh" content="240;URL=#{facesContext.externalContext.requestContextPath}/contas-angularjs.html" />
<title>Minhas Contas</title>

<script type="text/javascript" src="./resources/js/angular.min.js"></script>
<script type="text/javascript" src="./resources/js/angular-locale_pt-br.js"></script>
<script type="text/javascript" src="./resources/js/rw-money-mask.js"></script>

<link rel="stylesheet" href="./resources/css/bootstrap.min.css"></link>
<link rel="stylesheet" href="./resources/css/angularStyle.css"></link>
<script src="./resources/js/jquery.min.js"></script>
<script src="./resources/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-animate.js"></script>
<script type="text/javascript">
	var app = angular.module('myapp', [ 'rw.moneymask' ]);

	app.controller('myappcontroller', function($scope, $http, $timeout, $q, $rootScope) {

		$scope.mostraEdicao = false
		$scope.listaAnos = []
		$scope.indrUsuarioLogado = false
		$scope.conta = {
			id : null,
			data_registro : null,
			descricao : "",
			valor : 0,
			dia_vencimento : null,
			numr_agrupador : 0,
			qtde_parcelas : 1,
			numr_parcela : 0,
			usuario : null,
			contaPai : null,
			valorParciais : 0,
			tipo : "D",
			data_mes : new Date(),
			flag_comum : "N"
		}
		$scope.usuarioLogado = {
			id : null,
			data_registro : null,
			login : "",
			senha : "",
			saldo : 0
		}
		$scope.contaFilha = JSON.parse(JSON.stringify($scope.conta))
		$scope.contaFilha.data_registro = new Date();

		$scope.contas = []
		$scope.contasFilhas = []
		$scope.userform = {
			usuario : "",
			senha : ""
		};

		$scope.msgs = {};

		$scope.msg = ""
		$scope.msgTitulo = "";
		$scope.msgClass = "";
		$scope.mes = 0;
		$scope.ano = 0;

		iniciarPrimeiraVez();

		function iniciarPrimeiraVez() {
			var promise = getUsuarioLogado();
			promise.then(function(r) {
				iniciar();
			}, function(r) {
				console.log(r);
			});
		}

		function iniciar() {

			var promiseListaAnos = listaAnos();

			promiseListaAnos.then(function(r) {
				$scope.mes = (new Date()).getMonth() + 1;
				$scope.ano = (new Date()).getFullYear();
				$scope.listarContas();
			}, function(r) {
				console.log(r);
			});

		}

		function msgErro(response) {

			if (response.config.url != null)
				delete $scope.msgs[response.config.url];

			if (response.data.mensagem != null) {
				$scope.msg = response.data.mensagem;
				if (response.status == 406) {
					$scope.msgTitulo = "Verifique!";
					$scope.msgClass = "alert alert-warning alert-dismissable fade in";
				} else if (response.status == 500) {
					$scope.msgTitulo = "Erro!";
					$scope.msgClass = "alert alert-danger alert-dismissable fade in";
				}
				timeoutMsg(3000);
			}
		}
		function msgSucesso(response) {
			//console.log(Object.keys($scope.msgs).length);

			if (response.config.url != null)
				delete $scope.msgs[response.config.url];

			if (response.data.mensagem != null) {
				$scope.msg = response.data.mensagem;
				$scope.msgTitulo = "Sucesso";
				$scope.msgClass = "alert alert-success alert-dismissable fade in";
				timeoutMsg(3000);
			}
		}

		$scope.totalDespesaMes = 0;
		$scope.totalReceitaMes = 0;
		$scope.totalDespesaPrevistoMes = 0;
		$scope.totalReceitaPrevistoMes = 0;
		$scope.totalDespesaPrevistoAcumulado = 0;
		$scope.totalReceitaPrevistoAcumulado = 0;

		function resumoContas() {
			$scope.msgs['rest/contas/resumoContas/' + $scope.mes + '/' + $scope.ano] = "Calculando previsão das contas...";
			$http({
				method : 'POST',
				url : 'rest/contas/resumoContas/' + $scope.mes + '/' + $scope.ano,
				data : angular.toJson($scope.contas),
				headers : {
					'Content-Type' : 'application/json'
				}
			}).then(function successCallback(response) {
				msgSucesso(response);
				$scope.totalDespesaMes = response.data.totalDespesaMes;
				$scope.totalReceitaMes = response.data.totalReceitaMes;
				$scope.totalDespesaPrevistoMes = response.data.totalDespesaPrevistoMes;
				$scope.totalReceitaPrevistoMes = response.data.totalReceitaPrevistoMes;
				$scope.totalDespesaPrevistoAcumulado = response.data.totalDespesaPrevistoAcumulado;
				$scope.totalReceitaPrevistoAcumulado = response.data.totalReceitaPrevistoAcumulado;
			}, function errorCallback(response) {
				msgErro(response);
				$scope.totalDespesaMes = 0;
				$scope.totalReceitaMes = 0;
				$scope.totalDespesaPrevistoMes = 0;
				$scope.totalReceitaPrevistoMes = 0;
				$scope.totalDespesaPrevistoAcumulado = 0;
				$scope.totalReceitaPrevistoAcumulado = 0;

			});

		}

		$scope.salvar = function() {

			$scope.msgs['rest/contas/salvar/'] = "Salvando conta...";
			$http({
				method : 'POST',
				url : 'rest/contas/salvar/',
				data : angular.toJson($scope.conta),
				headers : {
					'Content-Type' : 'application/json'
				}
			}).then(function successCallback(response) {
				msgSucesso(response);
				$scope.listarContas();
				if ($scope.conta.id == null) {
					$scope.novaConta();
				} else {
					$scope.editarConta($scope.conta);
				}
			}, function errorCallback(response) {
				msgErro(response);
			});

		}

		$scope.alterarSaldo = function() {
			$scope.msgs['rest/usuario/alterarSaldo/'] = "Alterando saldo...";
			$http({
				method : 'POST',
				url : 'rest/usuario/alterarSaldo/',
				data : angular.toJson($scope.usuarioLogado),
				headers : {
					'Content-Type' : 'application/json'
				}
			}).then(function successCallback(response) {
				msgSucesso(response);
				iniciar();
			}, function errorCallback(response) {
				msgErro(response);
			});
		}

		$scope.salvarFilha = function() {

			$scope.msgs['rest/contas/salvar/'] = "Salvando conta filha...";

			$scope.contaFilha.data_registro = new Date();
			$scope.contaFilha.data_mes = $scope.conta.data_mes;
			$scope.contaFilha.flag_comum = $scope.conta.flag_comum;
			$scope.contaFilha.tipo = $scope.conta.tipo;
			$scope.contaFilha.status = "A";
			$scope.contaFilha.usuario = $scope.conta.usuario;
			$scope.contaFilha.contaPai = $scope.conta;

			$http({
				method : 'POST',
				url : 'rest/contas/salvar/',
				data : angular.toJson($scope.contaFilha),
				headers : {
					'Content-Type' : 'application/json'
				}
			}).then(function successCallback(response) {
				msgSucesso(response);
				$scope.listarContasFilhas($scope.conta.id);
				$scope.novaContaFilha();
			}, function errorCallback(response) {
				msgErro(response)
			});
		}

		$scope.salvarTodos = function() {
			if (confirm('Salvar todas as parcelas relacionadas e não pagas iguais a essa?') == false) {
				return;
			}
			$scope.msgs['rest/contas/salvarTodos'] = "Salvando contas...";
			$http({
				method : 'POST',
				url : 'rest/contas/salvarTodos',
				data : angular.toJson($scope.conta),
				headers : {
					'Content-Type' : 'application/json'
				}
			}).then(function successCallback(response) {
				msgSucesso(response);
				$scope.listarContas();
				if (c.contaPai == null) {
					$scope.editarConta(response.data.objecto);
				} else {
					$scope.editarConta(response.data.objecto.contaPai);
				}
			}, function errorCallback(response) {
				msgErro(response)
			});
		}

		$scope.baixar = function(c) {
			$scope.msgs['rest/contas/baixar'] = "Baixando conta...";
			$http({
				method : 'POST',
				url : 'rest/contas/baixar',
				data : angular.toJson(c),
				headers : {
					'Content-Type' : 'application/json'
				}
			}).then(function successCallback(response) {
				msgSucesso(response);
				$scope.listarContas();
				if (c.contaPai == null) {
					$scope.cancelarEdicao();
				} else {
					$scope.editarConta(response.data.objecto.contaPai);
				}
			}, function errorCallback(response) {
				msgErro(response)
			});
		}

		$scope.cancelarBaixa = function(c) {
			$scope.msgs['rest/contas/cancelarBaixa'] = "Cancelando baixa de contas...";
			$http({
				method : 'POST',
				url : 'rest/contas/cancelarBaixa',
				data : angular.toJson(c),
				headers : {
					'Content-Type' : 'application/json'
				}
			}).then(function successCallback(response) {
				msgSucesso(response);
				$scope.listarContas();
				if (c.contaPai == null) {
					$scope.cancelarEdicao();
				} else {
					$scope.editarConta(response.data.objecto.contaPai);
				}
			}, function errorCallback(response) {
				msgErro(response)
			});
		}

		$scope.excluir = function(c) {
			if (confirm('Excluir conta (' + c.descricao + ')') == false) {
				return;
			}
			$scope.msgs['rest/contas/excluir'] = "Excluindo conta...";
			$http({
				method : 'DELETE',
				url : 'rest/contas/excluir',
				data : angular.toJson(c),
				headers : {
					'Content-Type' : 'application/json'
				}
			}).then(function successCallback(response) {
				msgSucesso(response);
				$scope.listarContas();
				if (c.contaPai == null) {
					$scope.cancelarEdicao();
				} else {
					$scope.editarConta(response.data.objecto.contaPai);
				}
			}, function errorCallback(response) {
				msgErro(response)
			});
		}

		$scope.excluirTodos = function() {
			if (confirm('Excluir todas as parcelas relacionadas e não pagas?') == false) {
				return;
			}
			$scope.msgs['rest/contas/excluirTodos'] = "Excluindo contas...";
			$http({
				method : 'DELETE',
				url : 'rest/contas/excluirTodos',
				data : angular.toJson($scope.conta),
				headers : {
					'Content-Type' : 'application/json'
				}
			}).then(function successCallback(response) {
				msgSucesso(response);
				$scope.listarContas();
				$scope.cancelarEdicao()
			}, function errorCallback(response) {
				msgErro(response)
			});
		}

		$scope.listarContas = function() {
			$scope.msgs['rest/contas/' + $scope.mes + '/' + $scope.ano] = "Buscando contas...";
			//$scope.cancelarEdicao();

			$http({
				method : 'GET',
				url : 'rest/contas/' + $scope.mes + '/' + $scope.ano
			}).then(function successCallback(response) {
				msgSucesso(response);
				$scope.contas = response.data;
				getUsuarioLogado();
				resumoContas();
			}, function errorCallback(response) {
				msgErro(response);
				$scope.contas = [];

			});

		}

		$scope.listarContasFilhas = function(idPai) {
			$scope.msgs['rest/contas/contasFilhas/' + idPai] = "Buscando contas filhas...";
			$http({
				method : 'GET',
				url : 'rest/contas/contasFilhas/' + idPai
			}).then(function successCallback(response) {
				msgSucesso(response);
				$scope.contasFilhas = response.data;
			}, function errorCallback(response) {
				msgErro(response);
				$scope.contasFilhas = [];

			});
		}

		function listaAnos() {
			$scope.msgs['rest/anos'] = "Buscando anos...";
			var deferred = $q.defer();
			$http({
				method : 'GET',
				url : 'rest/anos'
			}).then(function successCallback(response) {
				deferred.resolve(response);
				msgSucesso(response);
				$scope.listaAnos = response.data.listaAnos;
			}, function errorCallback(response) {
				deferred.reject(response);
				msgErro(response);
				$scope.listaAnos = [];
			});

			return deferred.promise;
		}

		function getUsuarioLogado() {
			$scope.msgs['rest/login/usuarioLogado'] = "Buscando usuario logado...";
			var deferred = $q.defer();
			$http({
				method : 'GET',
				url : 'rest/login/usuarioLogado'
			}).then(function successCallback(response) {
				deferred.resolve(response);
				msgSucesso(response);
				$scope.usuarioLogado = response.data.objeto;
				$scope.userform.usuario = $scope.usuarioLogado.login;
				$scope.userform.senha = '';
				disableLogin();
				$scope.indrUsuarioLogado = true;
			}, function errorCallback(response) {
				deferred.reject(response);
				msgErro(response);
			});

			return deferred.promise;
		}

		$scope.validaLogin = function() {
			$scope.msgs['rest/login/' + $scope.userform.usuario + '/' + $scope.userform.senha] = "Validando login...";
			if ($scope.userform.usuario == "" || $scope.userform.senha == "") {
				msgErro({
					config : {
						url : 'rest/login/' + $scope.userform.usuario + '/' + $scope.userform.senha
					},
					status : 406,
					data : {
						mensagem : 'Informar usuário e senha!'
					}
				});
				return;
			}
			$http({
				method : 'GET',
				url : 'rest/login/' + $scope.userform.usuario + '/' + $scope.userform.senha
			}).then(function successCallback(response) {
				msgSucesso(response);
				iniciarPrimeiraVez();
			}, function errorCallback(response) {
				msgErro(response)
				$scope.contas = [];
				$scope.indrUsuarioLogado = false;
			});
		}

		$scope.logout = function() {
			$scope.msgs['rest/login/logout'] = "Saindo do sistema...";
			$http({
				method : 'GET',
				url : 'rest/login/logout'
			}).then(function successCallback(response) {
				msgSucesso(response);
				$scope.contas = [];
				enableLogin();
				$scope.userform.senha = '';
				$scope.indrUsuarioLogado = false;
			}, function errorCallback(response) {
				msgErro(response)
			});
		}

		function disableLogin() {
			document.getElementById("usuario").disabled = true;
			document.getElementById("senha").disabled = true;
			document.getElementById("submit").disabled = true;
		}

		function enableLogin() {
			document.getElementById("usuario").disabled = false;
			document.getElementById("senha").disabled = false;
			document.getElementById("submit").disabled = false;
		}

		$scope.editarConta = function(c) {
			$scope.conta = JSON.parse(JSON.stringify(c));
			$scope.conta.data_mes = new Date(c.data_mes);
			document.getElementById("despesa").disabled = true;
			document.getElementById("receita").disabled = true;
			document.getElementById("qtdeParcelas").disabled = true;
			$scope.mostraEdicao = true;
			$scope.listarContasFilhas(c.id);
			$('#myModal').modal('show');
		}

		$scope.cancelarEdicao = function() {
			$scope.novaConta();
			$scope.mostraEdicao = false;
		}

		$scope.novaConta = function() {
			$scope.conta = {
				id : null,
				data_registro : null,
				descricao : "",
				valor : 0,
				dia_vencimento : null,
				numr_agrupador : 0,
				qtde_parcelas : 1,
				numr_parcela : 1,
				usuario : null,
				contaPai : null,
				valorParciais : 0,
				tipo : "D",
				data_mes : new Date($scope.ano, $scope.mes - 1, 1, new Date().getHours(), new Date().getMinutes(), new Date().getSeconds()),
				flag_comum : "N"
			}
			$scope.novaContaFilha();
			$scope.contasFilhas = [];
			document.getElementById("despesa").disabled = false;
			document.getElementById("receita").disabled = false;
			document.getElementById("qtdeParcelas").disabled = false;
			$scope.mostraEdicao = true;
			document.getElementById('descricao').focus();
		}

		$scope.novaContaFilha = function() {
			$scope.contaFilha = {
				id : null,
				data_registro : new Date(),
				descricao : "",
				valor : 0,
				dia_vencimento : null,
				numr_agrupador : 0,
				qtde_parcelas : 1,
				numr_parcela : 1,
				usuario : null,
				contaPai : null,
				valorParciais : 0,
				tipo : "D",
				data_mes : new Date(),
				flag_comum : "N"
			}
		}

		var promiseTimeoutMsg;

		function timeoutMsg(timeout) {

			$timeout.cancel(promiseTimeoutMsg);

			promiseTimeoutMsg = $timeout(function() {

				$scope.msg = "";

			}, timeout);

		}

		$scope.cssLinhaTabela = function(c) {

			css = [];
			css.cursor = "pointer";

			if (c.tipo == 'D') {
				if (c.status == "B") {
					css.color = "#DCBCB9";
				} else {
					if (c.valorParciais > 0) {
						css.color = "#A94442";
					} else {
						css.color = 'red';
					}
				}
			} else {

				if (c.status == "B") {
					css.color = "#C2D8C2";
				} else {
					if (c.valorParciais > 0) {
						css.color = '#3D803E';
					} else {
						css.color = 'green';
					}
				}
			}

			return css;
		}

		$scope.isObjectEmpty = function(obj) {
			return Object.keys(obj).length === 0;
		}

		$scope.cssVencimento = function(c) {

			css = [];

			if (c.status != "B") {
				if (c.dia_vencimento > 0) {
					var data = new Date($scope.ano, $scope.mes - 1, c.dia_vencimento);
					if (new Date() >= data) {
						css.background = 'black';
					}
				}
			}

			return css;
		}

	});
</script>

</head>
<body ng-app="myapp" ng-controller="myappcontroller">


	<div class="container-fluid" style="margin-top: 5px;">
		<!-- 		<div class="progress"> -->
		<!-- 			<div class="progress-bar" role="progressbar" aria-valuenow="{{progressBar}}" aria-valuemin="0" aria-valuemax="100" >{{progressCounter}}%</div> -->
		<!-- 		</div> -->

		<div class="row">
			<div class="col-sm-2">
				<div class="input-group">
					<span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span> <input id="usuario" type="text" class="form-control input-sm" name="usuario" placeholder="Usuário" ng-model="userform.usuario">
				</div>
				<div class="input-group">
					<span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span> <input id="senha" type="password" class="form-control input-sm" name="password" placeholder="Senha" ng-model="userform.senha">
				</div>
				<div class="row">
					<div class="col-sm-12"></div>
				</div>
				<button id="submit" type="submit" class="btn btn-default btn-sm" ng-click="validaLogin()">
					<span class="glyphicon glyphicon-log-in"> </span> Entrar
				</button>
				<button id="sair" type="submit" class="btn btn-default btn-sm" ng-click="logout()">
					<span class="glyphicon glyphicon-log-out"> </span> Sair
				</button>

				<div ng-hide="indrUsuarioLogado == false || !isObjectEmpty(msgs)">

					<hr>
					<div class="container">
						<div class="row">
							<div class="col-sm-12">
								<label>Resumo Mês</label>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<span style="color: red" id="despesaMes">{{totalDespesaMes | currency:'':2}}</span>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<span style="color: green" id="ReceitaMes">{{totalReceitaMes | currency:'':2}}</span>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<span id="totalMes">{{totalReceitaMes - totalDespesaMes | currency:'':2}}</span>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<label>Previsão Mês</label>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<span style="color: red" id="despesaPrevistoMes">{{totalDespesaPrevistoMes | currency:'':2}}</span>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<span style="color: green" id="despesaPrevistoMes">{{totalReceitaPrevistoMes | currency:'':2}}</span>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<span type="text" id="totalPrevisaoMes">{{usuarioLogado.saldo + (totalReceitaPrevistoMes - totalDespesaPrevistoMes) | currency:'':2}}</span>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<label>Prev. Acumulado</label>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<span style="color: red" id="despesaPrevistoAcumulado">{{totalDespesaPrevistoAcumulado | currency:'':2}}</span>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<span style="color: green" id="receitaPrevistoAcumulado">{{totalReceitaPrevistoAcumulado | currency:'':2}}</span>
							</div>
						</div>
						<div class="row">
							<div class="col-sm-12">
								<span id="totalAcumulado">{{usuarioLogado.saldo + (totalReceitaPrevistoAcumulado - totalDespesaPrevistoAcumulado) | currency:'':2}}</span>
							</div>
						</div>
					</div>
					<hr>
					<label for="valorSaldo">Saldo</label>
					<div class="input-group">
						<input type="text" id="valorSaldo" ng-model="usuarioLogado.saldo" size="10" money-mask class="form-control input-sm" />
						<div class="input-group-btn">
							<button id="alterarSaldo" type="submit" class="btn btn-default btn-sm" ng-click="alterarSaldo()">
								<i class="glyphicon glyphicon-save"> </i>
							</button>
						</div>
					</div>
					<hr>
				</div>
			</div>
			<div class="col-sm-10">

				<div ng-class="msgClass" style="position: fixed; z-index: 99999; right: 1%; top: 5px;" ng-hide="msg == ''">
					<strong>{{msgTitulo}} </strong> <a href="#" class="close" data-dismiss="alert" aria-label="close" ng-hide="msg == ''">&times;</a> {{msg}}
				</div>
				<div style="position: fixed; z-index: 99999; right: 45%; top: 45%;">
					<ul>
						<li ng-repeat="m in msgs">{{m}}</li>
					</ul>
				</div>

				<div ng-hide="indrUsuarioLogado == false || !isObjectEmpty(msgs)">

					<nav class="navbar navbar-default">
						<div class="container-fluid">
							<div class="navbar-header">
								<a class="navbar-brand" href="#"><select id="ano" ng-options="ano for ano in listaAnos" ng-model="ano"></select></a>
							</div>
							<ul class="nav navbar-nav">
								<li><a ng-click="mes = 1; listarContas(); cancelarEdicao();" href="#">Jan</a></li>
								<li><a ng-click="mes = 2; listarContas(); cancelarEdicao();" href="#">Fev</a></li>
								<li><a ng-click="mes = 3; listarContas(); cancelarEdicao();" href="#">Mar</a></li>
								<li><a ng-click="mes = 4; listarContas(); cancelarEdicao();" href="#">Abr</a></li>
								<li><a ng-click="mes = 5; listarContas(); cancelarEdicao();" href="#">Mai</a></li>
								<li><a ng-click="mes = 6; listarContas(); cancelarEdicao();" href="#">Jun</a></li>
								<li><a ng-click="mes = 7; listarContas(); cancelarEdicao();" href="#">Jul</a></li>
								<li><a ng-click="mes = 8; listarContas(); cancelarEdicao();" href="#">Ago</a></li>
								<li><a ng-click="mes = 9; listarContas(); cancelarEdicao();" href="#">Set</a></li>
								<li><a ng-click="mes = 10; listarContas(); cancelarEdicao();" href="#">Out</a></li>
								<li><a ng-click="mes = 11; listarContas(); cancelarEdicao();" href="#">Nov</a></li>
								<li><a ng-click="mes = 12; listarContas(); cancelarEdicao();" href="#">Dez</a></li>
							</ul>
						</div>
					</nav>
					<div class="table-responsive">
						<table id="tabelaContas" class="table table-hover table-striped table-bordered table-condensed">
							<thead>
								<tr>
									<th width="60"></th>
									<th width="3"></th>
									<th width="3"></th>
									<th width="3"></th>
									<th>Descrição</th>
									<th>Valor</th>
									<th>Parciais</th>
									<th>Vcto</th>
									<th>Parcela</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="c in contas">
									<td><a ng-click="excluir(c)" href="#"><img src="./resources/img/lixo.png"></a> <a ng-click="baixar(c)" ng-if="c.status=='A'" href="#" title="Baixar Conta"><img src="./resources/img/aberto.png"></a> <a ng-click="cancelarBaixa(c)" ng-if="c.status=='B'" href="#"
										title="Cancelar Baixa"><img src="./resources/img/baixado.png"></a></td>
									<td ng-style="cssVencimento(c)"></td>
									<td ng-style="{'background-color': c.tipo== 'D'? 'red':'green'}"></td>
									<td ng-style="{'background-color': c.flag_comum== 'S'? 'yellow': 'inherit'}"></td>
									<td ng-style="cssLinhaTabela(c)" ng-click="editarConta(c)">{{ c.descricao }}</td>
									<td ng-style="cssLinhaTabela(c)" ng-click="editarConta(c)">{{ c.valor | currency:"":2 }}</td>
									<td ng-style="cssLinhaTabela(c)" ng-click="editarConta(c)">{{ c.valorParciais | currency:"":2 }}</td>
									<td ng-style="cssLinhaTabela(c)" ng-click="editarConta(c)">{{ c.dia_vencimento }}</td>
									<td ng-style="cssLinhaTabela(c)" ng-click="editarConta(c)">{{ c.numr_parcela }} - {{ c.qtde_parcelas }}</td>
								</tr>
							</tbody>
						</table>
					</div>

					<button id="novaConta" ng-click="novaConta();" onclick="$('#myModal').modal('show');" type="submit" class="btn btn-default">
						<span class="glyphicon glyphicon-plus"> </span> Nova
					</button>
					<div class="row" style="min-height: 10px !important">
						<div class="col-sm-12"></div>
					</div>

					<!-- Modal -->
					<div id="myModal" class="modal fade" role="dialog" tabindex="-1" ng-hide="mostraEdicao == false">
						<div class="modal-dialog {{conta.id == null ? 'modal-sm' : 'modal-lg'}}" role="document">

							<!-- Modal content-->
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal">&times;</button>
									<h4 class="modal-title">Editar Conta</h4>
								</div>
								<div class="modal-body">

									<div id="editarConta">
										<div class="row">
											<div class="{{conta.id == null ? 'col-sm-12' : 'col-sm-5'}}">
												<div class="panel panel-default">
													<div class="panel-heading">Conta</div>
													<div class="panel-body">
														<div class="row">
															<div class="col-sm-4">
																<label style="color: black; background-color: yellow" for="flagComun"><input title="Conta Comun a todos os meses" type="checkbox" id="flagComun" ng-model="conta.flag_comum" size="30" ng-true-value="'S'" ng-false-value="'N'"> Comun</label>
															</div>
															<div class="col-sm-4">
																<label style="color: green;" for="receita"><input id="receita" type="radio" ng-model="conta.tipo" value="R"> Receita</label>
															</div>
															<div class="col-sm-4">
																<label style="color: red;" for="despesa"><input id="despesa" type="radio" ng-model="conta.tipo" value="D"> Despesa</label>
															</div>
														</div>
														<div class="container-fluid" style="padding-left: initial; padding-right: initial;" ng-style="conta.tipo == 'D'? {color: 'red'}: {color: 'green'}">
															<div class="row">
																<div class="col-sm-12">
																	<span for="descricao">Descrição</span><input type="text" id="descricao" ng-model="conta.descricao" size="30" class="form-control">

																</div>
															</div>
															<div class="row">
																<div class="col-sm-12">
																	<span for="valor">Valor</span><input type="text" id="valor" ng-model="conta.valor" money-mask size="10" class="form-control">
																</div>
															</div>
															<div class="row">
																<div class="col-sm-12">
																	<span for=Data>Data</span><input type="date" id="data" name="data" ng-model="conta.data_mes" class="form-control" />
																</div>
															</div>
															<div class="row">
																<div class="col-sm-12">
																	<span for="vencimento">Vencimento</span><input type="number" min="1" max="31" id="vencimento" ng-model="conta.dia_vencimento" class="form-control">
																</div>
															</div>
															<div class="row">
																<div class="col-sm-12">
																	<span for="parcela">Parcela</span><input disabled="disabled" type="text" id="parcela" ng-value="conta.numr_parcela + ' - ' + conta.qtde_parcelas" class="form-control">
																</div>
															</div>
															<div class="row">
																<div class="col-sm-12">
																	<span for="qtdeParcelas">Parcelas</span><input type="number" id="qtdeParcelas" ng-model="conta.qtde_parcelas" class="form-control">
																</div>
															</div>
														</div>
														<div class="row" style="min-height: 10px !important">
															<div class="col-sm-12"></div>
														</div>
														<div class="row">
															<div class="col-sm-12">
																<button id="salvar" ng-click="salvar();" type="submit" class="btn btn-default">
																	<span class="glyphicon glyphicon-save"> </span> Salvar
																</button>
																<button id="salvarTodos" ng-hide="conta.qtde_parcelas == 1 || conta.id == null" ng-click="salvarTodos();" type="submit" class="btn btn-default" title="Salva todas as parcelas relacionadas não baixadas iguais a essa!">
																	<span class="glyphicon glyphicon-save"> </span> Salvar Parcelas
																</button>
																<button id="excluirTodos" ng-hide="conta.qtde_parcelas == 1 || conta.id == null" ng-click="excluirTodos();" type="submit" class="btn btn-default" title="Exclui tdas as parcelas relacionadas não baixadas!">
																	<span class="glyphicon glyphicon-trash"> </span> Excluir Parcelas
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
											<div class="col-sm-7" ng-hide="conta.id == null">

												<div class="panel panel-default">
													<div class="panel-heading">Parciais</div>
													<div class="panel-body">
														<div class="row">
															<div class="col-sm-5">
																<label for="descricaoFilha">Descrição</label><input type="text" id="descricaoFilha" ng-model="contaFilha.descricao" size="30" class="form-control">
															</div>
															<div class="col-sm-3">
																<label for="valorFilha">Valor</label><input type="text" id="valorFilha" ng-model="contaFilha.valor" size="10" money-mask class="form-control">
															</div>
															<div class="col-sm-4">
																<label for=dataFilha>Data</label><input type="date" id="dataFilha" name="data" ng-model="contaFilha.data_registro" class="form-control" />
															</div>
														</div>
														<div class="row" style="min-height: 10px !important">
															<div class="col-sm-12"></div>
														</div>
														<div class="row">
															<div class="col-sm-12">
																<button id="salvar" ng-click="salvarFilha();" type="submit" class="btn btn-default">
																	<span class="glyphicon glyphicon-save"> </span> Salvar
																</button>
															</div>
														</div>
														<div class="row" style="min-height: 10px !important">
															<div class="col-sm-12"></div>
														</div>
														<div class="row">
															<div class="col-sm-12">
																<div class="table-responsive" ng-hide="contasFilhas.length <= 0">
																	<table id="tabelaParciais" class="table table-hover table-striped table-bordered table-condensed">
																		<thead>
																			<tr>
																				<th width="50"></th>
																				<th>Descrição</th>
																				<th>Valor</th>
																				<th>Data Registro</th>
																			</tr>
																		</thead>
																		<tbody>
																			<tr ng-repeat="c in contasFilhas">
																				<td><a ng-click="excluir(c)" href="#"> <span class="glyphicon glyphicon-trash"></span></a> <a ng-click="baixar(c)" ng-if="c.status=='A'" href="#" title="Baixar Conta"><span class="glyphicon glyphicon-folder-open"></span></a> <a ng-click="cancelarBaixa(c)"
																					ng-if="c.status=='B'" href="#" title="Cancelar Baixa"><span class="glyphicon glyphicon-folder-close"></span></a></td>
																				<td ng-style="cssLinhaTabela(c)">{{ c.descricao }}</td>
																				<td ng-style="cssLinhaTabela(c)">{{ c.valor | currency:"":2 }}</td>
																				<td ng-style="cssLinhaTabela(c)">{{ c.data_registro | date:'dd/MM/yyyy HH:mm:ss' }}</td>
																			</tr>
																		</tbody>
																	</table>
																</div>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>

								</div>
								<div class="modal-footer">
									<!-- 									<button type="button" class="btn btn-default" data-dismiss="modal">Close</button> -->
								</div>
							</div>

						</div>
					</div>



					<hr>
				</div>
			</div>
		</div>
	</div>
</body>
</html>